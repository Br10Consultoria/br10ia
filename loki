primeiro criar o arquivo de configuracao, vai em config no portainer
cria um arquivo com o nome abaixo:
loki_config
conteudo :

auth_enabled: false

server:
  http_listen_port: 3100

common:
  path_prefix: /loki
  storage:
    filesystem:
      chunks_directory: /loki/chunks
      rules_directory: /loki/rules
  replication_factor: 1
  ring:
    kvstore:
      store: inmemory

schema_config:
  configs:
    - from: 2023-01-01
      store: boltdb-shipper
      object_store: filesystem
      schema: v11
      index:
        prefix: index_
        period: 24h

# ðŸ”´ CORREÃ‡ÃƒO DO ERRO
limits_config:
  allow_structured_metadata: false


depois vai em stacks e sobe a stack com o conteudo abaixo:

version: "3.9"

services:
  loki:
    image: grafana/loki:latest
    hostname: "{{.Service.Name}}.{{.Task.Slot}}"

    command:
      - -config.file=/etc/loki/loki-config.yml

    environment:
      - TZ=America/Bahia

    volumes:
      - loki_data:/loki

    configs:
      - source: loki_config
        target: /etc/loki/loki-config.yml

    networks:
      - network_public

    deploy:
      mode: replicated
      replicas: 1

      placement:
        constraints:
          - node.role == manager

      restart_policy:
        condition: any

      labels:
        - traefik.enable=true
        - traefik.docker.network=network_public

        # HTTP
        - traefik.http.routers.loki-http.rule=Host(`loki.ismtelecom.com.br`)
        - traefik.http.routers.loki-http.entrypoints=web

        # HTTPS
        - traefik.http.routers.loki-https.rule=Host(`loki.ismtelecom.com.br`)
        - traefik.http.routers.loki-https.entrypoints=websecure
        - traefik.http.routers.loki-https.tls=true
        - traefik.http.routers.loki-https.tls.certresolver=letsencrypt

        # Service
        - traefik.http.services.loki.loadbalancer.server.port=3100

volumes:
  loki_data:

configs:
  loki_config:
    external: true

networks:
  network_public:
    external: false
